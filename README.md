# Задача

Мне нужно написать логику динамического обновления backend base url, тк домены улетают в бан;)
Так вот, решил написать просто стор, где я все инициализирую, добавляю interceptor для axios (обвноление base url должно происходить при определенных ошибках). 

Дефолтное состояние - беру первый из списка доменов, что лежит у меня в env файле
Если недоступно, переключаю на след. (если идут параллельные запросы, то нужно как то определять что динамический подбор работающего домена уже идет, и не нужно начинать флоу по новой, то есть парралельные подборы нужно исключить)

Если запрос ушел с baseUrl1 и получил нужную ошибку и тут же идет другой запрос с baseUrl1 то я наничаю подбор домена и для второго запроса показываю ошибку

В проекте в некоторых местах где идут одновременно неск запросов.

Было бы очень просто если это все) но это не все

Если мой список доменов исчерпан (пробежался по ним и доменов больше нет), то я беру конфиг из yandex s3, расшифровываю его
Там структура следующяя 

export interface S3Config {
  domains: string[];
  proxies: ProxyConfig[];
  actualBacketUrl?: string;
}

если я перешел на s3 хоть 1 раз, то все, свои домены (из env) я отбрасываю и при последующем состоянии, когда доменов больше нет, то опять подтягиваю конфиг из s3

Для s3 есть ограничение, 1 минута, нельзя запрашивать новый конфиг неск раз в теч 1 минуты

активным доменом становится actualBacketUrl, если есть, и все домены (domains) идут в очередь
если нет, то первый из domains и все ост в очередь

И тут тоже не все)) 
Если пробежался по доменам, и все еще запрос не отработал, то в помощь приходят прокси
мне нужно проксировать запросы которые идут из расширения в бэкенд, чтобы получить данные

То есть 3 состояние - это использовать проксирование запросов для всех доменов env + domains from s3 
Прокси тоже массив, то есть baseUrl1 + proxy1, baseUrl1 + proxy2 etc..
baseUrl2 + proxy1, baseUrl2 + proxy2 etc - флоу такой 

если переключился на 3 состояние, то все 2 отбрасываются, то есть нет обратного возвращения к предыдущим состояниям.

Отдельная история с проксированием, мне главное сейчас написать структуру и флоу преключения из 1 состояние в другое

вот, что есть, комменты в коде еще оставлю
